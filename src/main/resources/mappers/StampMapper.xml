<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mountain.doo.repository.StampMapper">

    <select id="stampCount" resultType="Stamp">
        SELECT account_id,attend_count,board_count,banner_click_count,current_stamp_count,total_stamp_count
        FROM stamp
        WHERE account_id = #{accountId}

    </select>

<!--    배너 +1 시키는 쿼리-->
    <update id="bannerPlus">
        UPDATE stamp
        SET banner_click_count = banner_click_count+1
        WHERE account_id = #{accountId}
    </update>

<!--    해당 id가 작성한 게시물 개수 확인-->
    <update id="myBoard">
    UPDATE stamp
        SET board_count = (
    SELECT COUNT(*) AS total_count
    FROM (
    SELECT issue_board_no FROM issue WHERE account_id = #{accountId}
    UNION ALL
    SELECT secondhand_board_no FROM secondhand WHERE account_id = #{accountId}
    UNION ALL
    SELECT club_board_no FROM club WHERE account_id = #{accountId}
    UNION ALL
    SELECT review_board_no FROM review WHERE account_id = #{accountId}
    UNION ALL
    SELECT feed_board_no FROM feed WHERE account_id = #{accountId}
    ) AS combined_table)
        WHERE account_id = #{accountId};
    </update>

<!--    날짜비교 게시판-->
    <select id="myBoardTime" resultType="int">
        select stamp
        SET board_count = (
        SELECT COUNT(*) AS total_count
        FROM (
        SELECT issue_board_no FROM issue WHERE account_id = #{accountId}
        UNION ALL
        SELECT secondhand_board_no FROM secondhand WHERE account_id = #{accountId}
        UNION ALL
        SELECT club_board_no FROM club WHERE account_id = #{accountId}
        UNION ALL
        SELECT review_board_no FROM review WHERE account_id = #{accountId}
        UNION ALL
        SELECT feed_board_no FROM feed WHERE account_id = #{accountId}
        ) AS combined_table)
        WHERE account_id = #{accountId};
    </select>



<!--    게시판 작성시 +1-->
    <update id="boardPlus">
        UPDATE stamp
        SET board_count = board_count+1
        WHERE account_id = #{accountId}
    </update>

<!--    내가 쓴 게시물 찾기-->
<!--    <select id="myBoard" resultType="int">-->
<!--        select count(board_no)-->
<!--        from stamp-->
<!--        inner join feed on stamp.account_id = feed.account_id-->
<!--    </select>-->

<!-- 스탬프 개수 1-->

    <update id="stampAdd">
        UPDATE stamp
        SET total_stamp_count=total_stamp_count+1
        WHERE account_id = #{accountId}
    </update>

<!--    현재 스탬프개수 +1-->
    <update id="currentAdd">
        UPDATE stamp
        SET current_stamp_count=current_stamp_count+1
        WHERE account_id = #{accountId}
    </update>

    <!--    현재 스탬스개수 count-->
    <select id="currentCount" resultType="int">
        SELECT current_stamp_count
        from stamp
        WHERE account_id = #{accountId}

    </select>

<!--    응모권사용 현재 스탬프 -18-->
    <update id="openEvent">
        UPDATE stamp
        SET current_stamp_count = current_stamp_count-18
        WHERE account_id = #{accountId}
    </update>


    <!--     로그인여부 확인-->
    <update id="isLogin">
        UPDATE stamp
        SET attend_count = #{attendCount}
        WHERE account_id = #{accountId}
    </update>


</mapper>
